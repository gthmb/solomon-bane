"use strict";var Utils={mouseUpCallbacks:[],bind:function(a,b){return function(){b.apply(a,arguments)}},addClass:function(a,b){b=b.replace(/^\s+|\s+$/g,""),a.className=a.className.replace(/^\s+|\s+$/g,""),-1==a.className.indexOf(b)&&(a.className.length>0&&(b=" "+b),a.className+=b)},removeClass:function(a,b){b=b.replace(/^\s+|\s+$/g,""),a.className=a.className.replace(b,""),a.className=a.className.replace(/\s{2,}/g," "),a.className=a.className.replace(/^\s+|\s+$/g,"")},restrictNumber:function(a,b,c){var d=parseFloat(a);return isNaN(d)?null:("number"==typeof b&&(d=Math.max(d,b)),"number"==typeof c&&(d=Math.min(d,c)),d)},padString:function(a,b,c){for(var d=String(a);d.length<c;)d=b+d;return d},extend:function(a,b){var c=Object.create(a);for(var d in b)c[d]=b[d];return c},post:function(a){var b=JSON.stringify(a.data),c=new XMLHttpRequest;a.success&&c.addEventListener("load",function(b){var d=b.target.response;try{d=JSON.parse(d)}catch(e){}a.success(b,d,c)}),a.error&&c.addEventListener("error",function(b){a.error(b,c)}),c.open("POST",a.url),c.setRequestHeader("Content-Type","application/json"),c.send(b)},get:function(a){var b=new XMLHttpRequest;a.success&&b.addEventListener("load",function(c){var d=c.target.response;try{d=JSON.parse(d)}catch(e){}a.success(c,d,b)}),a.error&&b.addEventListener("error",function(c){a.error(c,b)}),b.open("GET",a.url),b.send()},formatTemplate:function(a,b){return a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})},prettifyDate:function(a){var b="",c=["January","February","March","April","May","June","July","August","September","October","November","December"];return b=c[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear()},addMouseUpCallback:function(a){this.mouseUpCallbacks.push(a)}};"mousedown touchdown".split(" ").forEach(function(a){window.addEventListener(a,function(){Utils.touchdown=!0},!1)}),"mouseup touchup".split(" ").forEach(function(a){window.addEventListener(a,function(){Utils.touchdown=!1;for(var a=0,b=Utils.mouseUpCallbacks.length;b>a;a++)Utils.mouseUpCallbacks[a]();Utils.mouseUpCallbacks=[]},!1)});var BaseValidationField=function(a){return this.init(a),this};BaseValidationField.prototype={init:function(a){this.el=a,this.required=!this.el.attributes.required||"true"!==this.el.attributes.required.value&&this.el.attributes.required.value!==!0?!1:!0,this.valid=!1,this.validationHelpers=this.el.form?this.el.form.querySelectorAll("[helps*="+this.el.attributes.name.value+"]"):[];this.el.addEventListener("blur",Utils.bind(this,this.validate),this)},validate:function(a){this.doValidation(),this.valid?(Utils.removeClass(this.el,"has-error"),Utils.removeClass(this.el,"has-warning"),this.hideValidationHelpers()):this.required?(Utils.addClass(this.el,"has-error"),this.showValidationHelpers()):this.el.value&&(Utils.addClass(this.el,"has-warning"),this.showValidationHelpers())},showValidationHelpers:function(){if(Utils.touchdown)return void Utils.addMouseUpCallback(Utils.bind(this,this.showValidationHelpers));for(var a=0,b=this.validationHelpers.length;b>a;a++)this.validationHelpers[a].style.display="block"},hideValidationHelpers:function(){if(Utils.touchdown)return void Utils.addMouseUpCallback(Utils.bind(this,this.hideValidationHelpers));for(var a=0,b=this.validationHelpers.length;b>a;a++)this.validationHelpers[a].style.display=""},resetValidationState:function(){this.hideValidationHelpers(),Utils.removeClass(this.el,"has-error"),Utils.removeClass(this.el,"has-warning")},doValidation:function(){}};var TextValidationField=function(a){this.init(a)};TextValidationField.prototype=Utils.extend(BaseValidationField.prototype,{init:function(){if(BaseValidationField.prototype.init.apply(this,arguments),this.pattern=this.el.attributes.pattern?new RegExp(this.el.attributes.pattern.value):null,this.formats=this.el.attributes.format?this.el.attributes.format.value.split("|"):null,this.validChars=this.el.attributes.validchars?new RegExp(this.el.attributes.validchars.value):null,this.el.attributes.pad){var a=this.el.attributes.pad.value.split("|");this.pad={"char":a[0],length:parseInt(a[1])}}else this.pad=null;if(this.validChars){this.el.addEventListener("keypress",Utils.bind(this,this.onKeypress),this),this.el.addEventListener("change",Utils.bind(this,this.onChange),this)}},onKeypress:function(a){if(8==a.which||9==a.which||13==a.which||0==a.which)return!0;var b=String.fromCharCode(a.which);return this.validChars.test(b)?void 0:(a.preventDefault(),!1)},onChange:function(a){var b="";for(var c in this.el.value)this.validChars.test(this.el.value[c])&&(b+=this.el.value[c]);this.el.value=b},doValidation:function(){var a=this.el.value.replace(/^\s+|\s+$/g,"");return this.formats&&(a=this.applyFormats(a)),a?this.pattern&&!this.pattern.test(a)?void(this.valid=!1):(this.pad&&(a=Utils.padString(a,this.pad["char"],this.pad.length)),this.valid=!0,void(this.el.value=a)):void(this.valid=!1)},applyFormats:function(a){for(var b in this.formats){var c=this.formats[b];switch(c){case"ucfirst":a=a.substr(0,1).toUpperCase()+a.substr(1);break;case"ssn":a=a.replace(/[^0-9]/g,""),a=a.replace(/^(\d{3})(\d{2})(\d{4})$/,"$1-$2-$3");break;case"phone":a=a.replace(/[^0-9]/g,""),a=a.replace(/^(\d{3})(\d{3})(\d{4})$/,"($1) $2-$3");break;case"comma_int":a=a.split(".")[0],a=a.replace(/[^0-9]/g,""),a=a.replace(/(\d)(?=(\d\d\d)+$)/g,"$1,")}}return a}});var SelectValidationField=function(a){this.init(a)};SelectValidationField.prototype=Utils.extend(BaseValidationField.prototype,{doValidation:function(){this.valid=this.el.selectedIndex>0&&this.el.options[this.el.selectedIndex].value?!0:!1}});var ValidationFieldFactory={create:function(a){if("select"==a.nodeName.toLowerCase())return new SelectValidationField(a);if("input"==a.nodeName.toLowerCase())switch(a.type){case"text":case"tel":case"number":case"email":return new TextValidationField(a)}return null}},BaseView=function(a){this.init(a)};BaseView.prototype={el:null,templates:{},init:function(a){this.el=a;for(var a in this.templates)this.templates[a]=this.templates[a]?this.templates[a].innerHTML:""},show:function(a){this.el&&(a===!1?Utils.addClass(this.el,"hidden"):(Utils.addClass(this.el,"fade-in"),Utils.removeClass(this.el,"hidden")))}};var BaseFormView=function(a){this.init(a)};BaseFormView.prototype=Utils.extend(BaseView.prototype,{init:function(a){BaseView.prototype.init.apply(this,arguments),this.validator=new FormValidator({el:this.el})},show:function(a){a!==!1&&this.validator.resetValidationStates(),BaseView.prototype.show.apply(this,arguments)},getData:function(){for(var a={},b=this.el.querySelectorAll("textarea, select, input"),c=0,d=b.length;d>c;c++)b[c].attributes.name&&(a[b[c].attributes.name.value]=b[c].value);return a},setData:function(a){for(var b=this.el.querySelectorAll("textarea, select, input"),c=0,d=b.length;d>c;c++){var e=b[c].attributes.name.value;a.hasOwnProperty(e)&&(b[c].value=a[e])}},isValid:function(){return this.validator.isValid()}});var LandingView=function(a){this.init(a)};LandingView.prototype=Utils.extend(BaseView.prototype,{init:function(a){BaseView.prototype.init.apply(this,arguments),this.startButtons=this.el.querySelector(".landing-start-buttons")},show:function(a,b){BaseView.prototype.show.apply(this,arguments),b===!1?Utils.addClass(this.startButtons,"hidden"):Utils.removeClass(this.startButtons,"hidden")}});var ApplicationView=function(a){this.init(a)};ApplicationView.prototype=Utils.extend(BaseFormView.prototype,{init:function(a){BaseFormView.prototype.init.apply(this,arguments),this.ageValidator=new AgeValidator({min:18,month_el:this.el.querySelector(".dob-inpt-month"),day_el:this.el.querySelector(".dob-inpt-day"),year_el:this.el.querySelector(".dob-inpt-year"),date_el:this.el.querySelector(".dob-inpt-year"),validationHelper:this.el.querySelector(".validation-helper-age")}),this.submit=this.el.querySelector(".btn-user-form-submit"),this.spinner=this.el.querySelector(".throbber"),this.submitError=this.el.querySelector(".submit-error"),this.dob=this.el.querySelector("[name=dob]")},show:function(a){a!==!1&&(Utils.removeClass(this.submit,"hidden"),Utils.addClass(this.spinner,"hidden"),Utils.addClass(this.submitError,"hidden")),BaseFormView.prototype.show.apply(this,arguments)},showError:function(){Utils.addClass(this.spinner,"hidden"),Utils.removeClass(this.submit,"hidden"),Utils.removeClass(this.submitError,"hidden")},hideSubmit:function(){Utils.removeClass(this.spinner,"hidden"),Utils.addClass(this.submit,"hidden"),Utils.addClass(this.submitError,"hidden")},isValid:function(){var a=BaseFormView.prototype.isValid.apply(this,arguments);return a&&(this.ageValidator.isValid()?this.dob.value=this.ageValidator.dob.toISOString():(a=!1,this.ageValidator.year_el.focus())),a}});var ViewApplicationsView=function(a){this.init(a)};ViewApplicationsView.prototype=Utils.extend(BaseFormView.prototype,{templates:{tr:document.querySelector("#application-tr")},init:function(a){BaseFormView.prototype.init.apply(this,arguments),this.spinner=this.el.querySelector(".throbber"),this.submit=this.el.querySelector(".btn-user-form-submit"),this.tbody=this.el.querySelector("tbody"),this.table=this.el.querySelector(".results")},show:function(a){BaseFormView.prototype.show.apply(this,arguments),this.tbody.innerHTML="",this.showResults(!1)},showSpinner:function(a){a!==!1?(Utils.removeClass(this.spinner,"hidden"),Utils.addClass(this.submit,"hidden")):(Utils.addClass(this.spinner,"hidden"),Utils.removeClass(this.submit,"hidden"))},showResults:function(a){a!==!1?Utils.removeClass(this.table,"hidden"):Utils.addClass(this.table,"hidden")},clearResults:function(){this.tbody.innerHTML=""},populateResults:function(a){this.clearResults();var b;if(a.length)for(var c=0,d=a.length;d>c;c++)b=document.createElement("tr"),b.innerHTML=Utils.formatTemplate(this.templates.tr,[c+1,a[c].first_name+" "+a[c].last_name,Utils.prettifyDate(new Date(a[c].created.replace(/-/g,"/"))),"warning",a[c].status]),this.tbody.appendChild(b);else b=document.createElement("tr"),b.innerHTML="<td class='info text-center'>No Applications Found. <a href='#basics'>Apply Now!</a></td>",this.tbody.appendChild(b)}});var AgeValidator=function(a){this.init(a)};AgeValidator.prototype={init:function(a){this.min=315576e5*a.min,this.month_el=a.month_el,this.day_el=a.day_el,this.year_el=a.year_el,this.validationHelper=a.validationHelper,this.month_el&&this.day_el&&this.day_el&&(this.month_el.addEventListener("blur",Utils.bind(this,this.onFieldBlur),!1),this.day_el.addEventListener("blur",Utils.bind(this,this.onFieldBlur),!1),this.year_el.addEventListener("blur",Utils.bind(this,this.onFieldBlur),!1),this.month_el.addEventListener("focus",Utils.bind(this,this.onFieldFocus),!1),this.day_el.addEventListener("focus",Utils.bind(this,this.onFieldFocus),!1),this.year_el.addEventListener("focus",Utils.bind(this,this.onFieldFocus),!1),this.now=new Date)},onFieldBlur:function(a){this.isValid()},onFieldFocus:function(a){this.validationHelper.style.display=""},isValid:function(){return this.month_el.value&&this.day_el.value&&this.year_el.value&&(this.dob=new Date(this.year_el.value,this.month_el.value-1,this.day_el.value),this.now.getTime()-this.dob.getTime()<this.min)?(this.validationHelper.style.display="block",!1):!0}};var FormValidator=function(a){this.init(a)};FormValidator.prototype={init:function(a){this.el=a.el,this.fields=[],this.requireds=[];for(var b=this.el.querySelectorAll("[validate=true], [required=true]"),c=0,d=b.length;d>c;c++){var e=ValidationFieldFactory.create(b[c]);e.required&&this.requireds.push(e),this.fields.push(e)}this.el.addEventListener("submit",Utils.bind(this,this.onSubmit),!0)},onSubmit:function(a){this.isValid()||a.preventDefault()},isValid:function(){var a=!0;for(var b in this.requireds)this.requireds[b].validate(),this.requireds[b].valid||(a&&this.requireds[b].el.focus(),a=!1);return a},resetValidationStates:function(){for(var a in this.fields)this.fields[a].resetValidationState()}};var Router=function(a){this.init(a)};Router.prototype={init:function(a){this.views=a,window.addEventListener("hashchange",Utils.bind(this,this.handleRoutes)),window.addEventListener("load",Utils.bind(this,this.handleRoutes))},handleRoutes:function(a){var b=a.target.location.hash;switch(b){case"":case"#":this.views.landing.show(),this.views.basics.show(!1),this.views.prevAppModal.show(!1),this.views.footer.show(!1),this.views.thanks.show(!1),this.views.application.show(!1),this.views.viewApplications.show(!1);break;case"#basics":this.views.basics.show(!0),this.views.basics.el.querySelector("[name=first_name]").focus(),this.views.landing.show(!0,!1),this.views.footer.show(),this.views.prevAppModal.show(!1),this.views.thanks.show(!1),this.views.application.show(!1),this.views.viewApplications.show(!1);break;case"#apply":this.views.application.show(),this.views.landing.show(!1),this.views.basics.show(!1),this.views.prevAppModal.show(!1),this.views.footer.show(),this.views.thanks.show(!1),this.views.viewApplications.show(!1);break;case"#view-applications":this.views.viewApplications.show(),this.views.landing.show(!1),this.views.basics.show(!1),this.views.prevAppModal.show(!1),this.views.footer.show(),this.views.thanks.show(!1),this.views.application.show(!1);break;case"#thanks":this.views.thanks.show(),this.views.footer.show(),this.views.landing.show(!1),this.views.basics.show(!1),this.views.prevAppModal.show(!1),this.views.application.show(!1),this.views.viewApplications.show(!1)}}};